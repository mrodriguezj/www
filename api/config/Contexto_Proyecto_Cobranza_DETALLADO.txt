
 DOCUMENTACIN EXTENDIDA DEL PROYECTO COBRANZA

1锔 INTRODUCCIN
El sistema de CobranzaWeb es una soluci贸n integral para la gesti贸n de ventas de terrenos y su correspondiente proceso de cobranza. Facilita el registro de clientes, ventas, generaci贸n de calendarios de pago, control de pagos realizados y c谩lculo de comisiones para vendedores. El objetivo es lograr un sistema robusto, seguro, modular y escalable.

2锔 ARQUITECTURA GENERAL DEL SISTEMA
 Backend
- Desarrollado en PHP usando PDO para la conexi贸n con MySQL.
- Todos los procedimientos de negocio est谩n en la base de datos mediante Stored Procedures.
- Endpoints PHP consumen procedimientos y responden en JSON.
- Fuera de `public_html` por seguridad.

 Frontend
- HTML5 + TailwindCSS para dise帽o responsive.
- Formularios intuitivos y f谩ciles de usar.
- JS modularizado para cada m贸dulo (clientes.js, ventas.js, pagos.js).

 Base de Datos
- MySQL/MariaDB normalizado.
- Procedimientos almacenados garantizan la integridad de los datos.
- Manejo de transacciones con COMMIT/ROLLBACK.
- No se eliminan registros, se actualizan estados (Activo/Inactivo).

 Seguridad y Entorno
- Variables de entorno en `.env` para configuraci贸n sensible.
- Futuro soporte de JWT para autenticaci贸n y autorizaci贸n.
- Acceso al backend solo desde rutas protegidas.

3锔 DESCRIPCIN DE LAS TABLAS

 clientes
- Datos identificativos (CURP, RFC, INE) y de contacto.
- Direcci贸n en un solo campo de texto.
- Estado del cliente (Activo/Inactivo).

 propiedades
- Registro de lotes con dimensiones, precio, desarrollo, etapa y estado de disponibilidad.
- Calles y etapas definidas.

 ventas
- Registro de ventas incluyendo precio base, precio de lista, descuentos, precio de venta final, enganche, saldo restante, forma de pago, mensualidades y fechas clave.
- Control del estado de la venta (Activa, Cancelada, Finalizada).

 calendario_pagos
- Generaci贸n autom谩tica de pagos programados a partir de la venta.
- Enganche, contado o mensualidades seg煤n la forma de pago.
- Control de fechas l铆mite y estado del pago (Pendiente, Pagado, Vencido).

 pagos_realizados
- Registro de pagos hechos por clientes.
- Relaci贸n con el lote, monto pagado, fecha, m茅todo y observaciones.

 pagos_mensualidades_relacion
- Detalle de a qu茅 mensualidades se ha aplicado un pago realizado.
- Controla pagos parciales o anticipados.

 historial_comisiones
- Registro de comisiones generadas a partir de pagos realizados.
- No afecta la cobranza, es informativo y para control interno.

 referencia_pagos_anteriores
- Tabla auxiliar para referenciar pagos del sistema anterior.

4锔 PROCEDIMIENTOS ALMACENADOS PRINCIPALES

 insertar_cliente
- Inserta un nuevo cliente.
- Normaliza CURP, RFC, nombres y apellidos.

 registrar_venta_y_generar_calendario
- Crea una venta.
- Actualiza la propiedad a "Vendido".
- Genera calendario de pagos acorde a la venta.

 registrar_pago
- Registra el pago realizado.
- Aplica el monto a los pagos pendientes en el calendario.
- Actualiza los estados de pago.
- Genera el registro de comisi贸n.

 reportes_cobranza_mensual
- Consulta de cobranza mensual esperada vs. recibida.

5锔 ENDPOINTS DE API

 Estructura
- index.php como router central.
- Endpoints modularizados: clientes, ventas, pagos.

 Seguridad
- Ubicaci贸n fuera de `public_html`.
- Acceso controlado a trav茅s de una puerta de enlace.

 Ejemplos de Uso
- POST /api/index.php?endpoint=registrar_cliente
- POST /api/index.php?endpoint=registrar_venta
- POST /api/index.php?endpoint=registrar_pago

6锔 FORMULARIOS Y JS

 Clientes
- Formulario horizontal, limpio y validado.
- Validaciones en JS para tipos de datos y formatos.

 Ventas
- Formulario detallado con precios calculados y campos bloqueados para consistencia.
- Autocompletado de clientes y lotes mediante JSON.

 Pagos
- Registro de pagos con porcentaje de comisi贸n.
- Autocompletado de lotes.
- Confirmaci贸n visual del registro de pagos.

7锔 FLUJO DE TRABAJO COMPLETO

 Flujo General
1. Registrar cliente.
2. Registrar propiedad.
3. Registrar venta (se genera calendario y cambia estado del lote).
4. Registrar pago (afecta calendario y registra comisiones).

 Casos de Negocio Contemplados
- Enganche + Contado.
- Enganche + Financiamiento.
- Pagos adelantados o parciales.
- Pagos vencidos y control de fechas l铆mites.

8锔 REGLAS DE NEGOCIO

- Propiedades: Una vez vendidas, no se revenden.
- Fechas de pagos siempre en el rango 1-30 (Febrero se ajusta a 28).
- Comisiones se calculan a partir de cada pago.
- Pagos anticipados aplican a mensualidades siguientes.

9锔 BUENAS PRCTICAS

- Seguridad por dise帽o (back fuera de public_html).
- Variables de entorno en .env, nunca en el c贸digo.
- Validaci贸n doble: cliente y servidor.
- Procedimientos almacenados para l贸gica de negocio, no en el c贸digo PHP.

 FUTURAS MEJORAS

- Implementaci贸n de JWT para usuarios y roles.
- Dashboard de reportes en tiempo real.
- Notificaciones autom谩ticas (correo/WhatsApp).
- Generaci贸n de estados de cuenta PDF/Excel.
- Control de usuarios internos con permisos y auditor铆a.
